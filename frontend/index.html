
<!-- food_calorie_calculator/frontend/index.html -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ç¾é£Ÿå¡è·¯é‡Œè®¡ç®—å™¨</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
  <link href="https://fonts.loli.net/css?family=Noto+Sans+SC:400,500,700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Noto Sans SC', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
    }
    .particles-js {
      position: absolute;
      width: 100%;
      height: 100%;
      z-index: -1;
    }
    .card {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
    }
    .btn-primary {
      background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      transition: all 0.3s ease;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(118, 75, 162, 0.4);
    }
    .upload-area {
      border: 2px dashed #c3cfe2;
      transition: all 0.3s ease;
    }
    .upload-area:hover {
      border-color: #667eea;
      background: rgba(102, 126, 234, 0.05);
    }
    .result-display {
      min-height: 200px;
      background: linear-gradient(45deg, #f5f7fa 0%, #e4e8f0 100%);
      border-radius: 15px;
    }
    .tab-active {
      border-bottom: 3px solid #667eea;
      color: #667eea;
      font-weight: 500;
    }
    .user-input {
      background: linear-gradient(45deg, #f8fafc 0%, #e2e8f0 100%);
    }
  </style>
</head>
<body class="py-8 px-4">
  <div id="particles-js" class="particles-js"></div>
  
  <div class="max-w-4xl mx-auto">
    <header class="text-center mb-10">
      <h1 class="text-4xl font-bold text-gray-800 mb-2">ç¾é£Ÿå¡è·¯é‡Œè®¡ç®—å™¨</h1>
      <p class="text-gray-600">ä¸Šä¼ ç¾é£Ÿç…§ç‰‡ï¼Œè½»æ¾è®¡ç®—å¡è·¯é‡Œ</p>
    </header>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <!-- ä¸»åŠŸèƒ½åŒºåŸŸ -->
      <div class="md:col-span-2">
        <div class="card p-6 mb-6">
          <div class="upload-area rounded-lg p-8 text-center cursor-pointer mb-6" id="uploadArea">
            <input type="file" id="foodImage" accept="image/*" class="hidden">
            <div class="text-5xl mb-4">ğŸ“·</div>
            <h3 class="text-xl font-medium mb-2">ä¸Šä¼ ç¾é£Ÿç…§ç‰‡</h3>
            <p class="text-gray-500">ç‚¹å‡»æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„</p>
          </div>
          
          <div class="result-display p-6 mb-6 flex flex-col items-center justify-center" id="resultDisplay">
            <div class="text-5xl mb-4">ğŸ½ï¸</div>
            <p class="text-gray-500">ç­‰å¾…åˆ†æç»“æœ...</p>
          </div>
          
          <div class="flex flex-wrap gap-3 justify-center">
            <button class="btn-primary px-6 py-3 rounded-full font-medium" id="calculateBtn">è®¡ç®—å¡è·¯é‡Œ</button>
            <button class="btn-primary px-6 py-3 rounded-full font-medium" id="saveBtn">æ”¶è—ç»“æœ</button>
            <button class="btn-primary px-6 py-3 rounded-full font-medium" id="shareBtn">åˆ†äº«ç»“æœ</button>
          </div>
        </div>
      </div>
      
      <!-- ä¾§è¾¹åŠŸèƒ½åŒºåŸŸ -->
      <div class="md:col-span-1 space-y-6">
        <!-- ç”¨æˆ·ä¿¡æ¯è¾“å…¥åŒºåŸŸ -->
        <div class="card p-6 user-input">
          <h3 class="text-xl font-medium mb-4">æ¯æ—¥å¡è·¯é‡Œå»ºè®®</h3>
          <div class="space-y-4">
            <div>
              <label for="height" class="block text-sm font-medium text-gray-700 mb-1">èº«é«˜ (cm)</label>
              <input type="number" id="height" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="è¯·è¾“å…¥èº«é«˜">
            </div>
            <div>
              <label for="weight" class="block text-sm font-medium text-gray-700 mb-1">ä½“é‡ (kg)</label>
              <input type="number" id="weight" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="è¯·è¾“å…¥ä½“é‡">
            </div>
            <div class="flex gap-2">
              <button class="btn-primary px-4 py-2 rounded-lg font-medium flex-1" id="calculateDailyBtn">è®¡ç®—å»ºè®®</button>
              <button class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium flex-1" id="clearUserBtn">æ¸…ç©º</button>
            </div>
          </div>
          <div class="mt-4 p-4 bg-white rounded-lg hidden" id="dailyResult">
            <h4 class="font-medium mb-2">æ‚¨çš„æ¯æ—¥å»ºè®®æ‘„å…¥é‡</h4>
            <p class="text-sm text-gray-600 mb-1">åŸºç¡€ä»£è°¢: <span id="bmrValue" class="font-bold text-blue-600">0</span> kcal</p>
            <p class="text-sm text-gray-600">æ¯æ—¥å»ºè®®: <span id="dailyCalorie" class="font-bold text-blue-600">0</span> kcal</p>
          </div>
        </div>

        <div class="card p-6">
          <div class="flex border-b mb-4">
            <button class="tab-btn py-2 px-4 mr-2 tab-active" data-tab="reference">å‚è€ƒå€¼</button>
            <button class="tab-btn py-2 px-4 mr-2" data-tab="favorites">æ”¶è—å¤¹</button>
            <button class="tab-btn py-2 px-4" data-tab="history">å†å²è®°å½•</button>
          </div>
          
          <div class="tab-content" id="reference">
            <h3 class="font-medium mb-3">å¸¸è§é£Ÿå“å¡è·¯é‡Œ</h3>
            <ul class="space-y-2">
              <li class="flex justify-between"><span>ğŸ è‹¹æœ</span> <span>52 kcal/100g</span></li>
              <li class="flex justify-between"><span>ğŸŒ é¦™è•‰</span> <span>89 kcal/100g</span></li>
              <li class="flex justify-between"><span>ğŸ— é¸¡è…¿</span> <span>215 kcal/100g</span></li>
              <li class="flex justify-between"><span>ğŸ• æŠ«è¨</span> <span>266 kcal/100g</span></li>
              <li class="flex justify-between"><span>ğŸœ æ‹‰é¢</span> <span>436 kcal/ç¢—</span></li>
            </ul>
          </div>
          
          <div class="tab-content hidden" id="favorites">
            <h3 class="font-medium mb-3">æˆ‘çš„æ”¶è—</h3>
            <div class="text-center py-8" id="favoritesList">
              <div class="text-4xl mb-3">â¤ï¸</div>
              <p class="text-gray-500">æš‚æ— æ”¶è—</p>
            </div>
          </div>
          
          <div class="tab-content hidden" id="history">
            <h3 class="font-medium mb-3">æŸ¥è¯¢å†å²</h3>
            <div class="text-center py-8" id="historyList">
              <div class="text-4xl mb-3">ğŸ•’</div>
              <p class="text-gray-500">æš‚æ— è®°å½•</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/particles.js/2.0.0/particles.min.js"></script>
  <script>
    // ç²’å­æ•ˆæœåˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      particlesJS('particles-js', {
        particles: {
          number: { value: 80, density: { enable: true, value_area: 800 } },
          color: { value: "#667eea" },
          shape: { type: "circle" },
          opacity: { value: 0.5, random: true },
          size: { value: 3, random: true },
          line_linked: { enable: true, distance: 150, color: "#c3cfe2", opacity: 0.4, width: 1 },
          move: { enable: true, speed: 2, direction: "none", random: true, straight: false, out_mode: "out" }
        },
        interactivity: {
          detect_on: "canvas",
          events: {
            onhover: { enable: true, mode: "repulse" },
            onclick: { enable: true, mode: "push" }
          }
        }
      });
      
      // æ ‡ç­¾åˆ‡æ¢åŠŸèƒ½
      const tabBtns = document.querySelectorAll('.tab-btn');
      tabBtns.forEach(btn => {
        btn.addEventListener('click', function() {
          const tabId = this.getAttribute('data-tab');
          
          // æ›´æ–°æ´»åŠ¨æ ‡ç­¾æ ·å¼
          tabBtns.forEach(b => b.classList.remove('tab-active'));
          this.classList.add('tab-active');
          
          // æ˜¾ç¤ºå¯¹åº”å†…å®¹
          document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.add('hidden');
          });
          document.getElementById(tabId).classList.remove('hidden');
        });
      });
      
      // å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½
      const uploadArea = document.getElementById('uploadArea');
      const foodImageInput = document.getElementById('foodImage');
      
      uploadArea.addEventListener('click', function() {
        foodImageInput.click();
      });
      
      foodImageInput.addEventListener('change', function(e) {
        if (e.target.files.length > 0) {
          const file = e.target.files[0];
          const reader = new FileReader();
          
          reader.onload = function(event) {
            const resultDisplay = document.getElementById('resultDisplay');
            resultDisplay.innerHTML = `
              <img src="${event.target.result}" class="max-h-48 rounded-lg mb-4" alt="ä¸Šä¼ çš„ç¾é£Ÿå›¾ç‰‡">
              <p class="text-gray-500">å·²é€‰æ‹©: ${file.name}</p>
            `;
          };
          
          reader.readAsDataURL(file);
        }
      });
      
      // æ‹–æ‹½ä¸Šä¼ åŠŸèƒ½
      uploadArea.addEventListener('dragover', function(e) {
        e.preventDefault();
        this.classList.add('bg-blue-50');
      });
      
      uploadArea.addEventListener('dragleave', function() {
        this.classList.remove('bg-blue-50');
      });
      
      uploadArea.addEventListener('drop', function(e) {
        e.preventDefault();
        this.classList.remove('bg-blue-50');
        
        if (e.dataTransfer.files.length > 0) {
          foodImageInput.files = e.dataTransfer.files;
          const event = new Event('change');
          foodImageInput.dispatchEvent(event);
        }
      });
      
      // æŒ‰é’®åŠŸèƒ½
      document.getElementById('calculateBtn').addEventListener('click', function() {
        const resultDisplay = document.getElementById('resultDisplay');
        if (!foodImageInput.files.length) {
          resultDisplay.innerHTML = `
            <div class="text-5xl mb-4">âš ï¸</div>
            <p class="text-gray-500">è¯·å…ˆä¸Šä¼ ç¾é£Ÿå›¾ç‰‡</p>
          `;
          return;
        }
        
        // æ¨¡æ‹Ÿè®¡ç®—è¿‡ç¨‹
        resultDisplay.innerHTML = `
          <div class="animate-spin text-4xl mb-4">ğŸŒ€</div>
          <p class="text-gray-500">æ­£åœ¨åˆ†æä¸­...</p>
        `;
        
        setTimeout(() => {
          // æ¨¡æ‹Ÿç»“æœ
          const calories = Math.floor(Math.random() * 500) + 100;
          resultDisplay.innerHTML = `
            <div class="text-5xl mb-4">ğŸ”</div>
            <h3 class="text-2xl font-medium mb-2">åˆ†æå®Œæˆ</h3>
            <p class="text-4xl font-bold text-blue-600 mb-2">${calories} kcal</p>
            <p class="text-gray-500">çº¦ç›¸å½“äº ${Math.round(calories/50)} ç¢—ç±³é¥­</p>
          `;
          
          // æ·»åŠ åˆ°å†å²è®°å½•
          addToHistory(foodImageInput.files[0].name, calories);
        }, 2000);
      });
      
      document.getElementById('saveBtn').addEventListener('click', function() {
        alert('æ”¶è—åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­');
      });
      
      document.getElementById('shareBtn').addEventListener('click', function() {
        alert('åˆ†äº«åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­');
      });

      // ç”¨æˆ·ä¿¡æ¯è®¡ç®—åŠŸèƒ½
      document.getElementById('calculateDailyBtn').addEventListener('click', calculateDailyCalories);
      document.getElementById('clearUserBtn').addEventListener('click', clearUserInput);

      // åŠ è½½ä¿å­˜çš„ç”¨æˆ·æ•°æ®
      loadUserData();
    });

    // è®¡ç®—æ¯æ—¥å»ºè®®å¡è·¯é‡Œ
    function calculateDailyCalories() {
      const height = parseFloat(document.getElementById('height').value);
      const weight = parseFloat(document.getElementById('weight').value);
      const dailyResult = document.getElementById('dailyResult');

      if (!height || !weight) {
        alert('è¯·è¾“å…¥å®Œæ•´çš„èº«é«˜å’Œä½“é‡ä¿¡æ¯');
        return;
      }

      // Harris-Benedictå…¬å¼è®¡ç®—åŸºç¡€ä»£è°¢ç‡(BMR)
      const bmr = 88.362 + (13.397 * weight) + (4.799 * height) - (5.677 * 30); // å‡è®¾å¹´é¾„30å²
      const dailyCalorie = bmr * 1.55; // ä¸­ç­‰æ´»åŠ¨æ°´å¹³

      // æ˜¾ç¤ºç»“æœ
      document.getElementById('bmrValue').textContent = Math.round(bmr);
      document.getElementById('dailyCalorie').textContent = Math.round(dailyCalorie);
      dailyResult.classList.remove('hidden');

      // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
      localStorage.setItem('userData', JSON.stringify({
        height: height,
        weight: weight,
        bmr: Math.round(bmr),
        dailyCalorie: Math.round(dailyCalorie)
      }));
    }

    // æ¸…ç©ºç”¨æˆ·è¾“å…¥
    function clearUserInput() {
      document.getElementById('height').value = '';
      document.getElementById('weight').value = '';
      document.getElementById('dailyResult').classList.add('hidden');
      localStorage.removeItem('userData');
    }

    // åŠ è½½ç”¨æˆ·æ•°æ®
    function loadUserData() {
      const userData = JSON.parse(localStorage.getItem('userData'));
      if (userData) {
        document.getElementById('height').value = userData.height;
        document.getElementById('weight').value = userData.weight;
        document.getElementById('bmrValue').textContent = userData.bmr;
        document.getElementById('dailyCalorie').textContent = userData.dailyCalorie;
        document.getElementById('dailyResult').classList.remove('hidden');
      }
    }
    
    // æœ¬åœ°å­˜å‚¨åŠŸèƒ½
    function addToHistory(foodName, calories) {
      let history = JSON.parse(localStorage.getItem('calorieHistory') || '[]');
      history.unshift({
        name: foodName,
        calories: calories,
        date: new Date().toLocaleString()
      });
      
      // åªä¿ç•™æœ€è¿‘10æ¡è®°å½•
      if (history.length > 10) history = history.slice(0, 10);
      
      localStorage.setItem('calorieHistory', JSON.stringify(history));
      updateHistoryDisplay();
    }
    
    function updateHistoryDisplay() {
      const history = JSON.parse(localStorage.getItem('calorieHistory') || '[]');
      const historyList = document.getElementById('historyList');
      
      if (history.length === 0) {
        historyList.innerHTML = `
          <div class="text-4xl mb-3">ğŸ•’</div>
          <p class="text-gray-500">æš‚æ— è®°å½•</p>
        `;
        return;
      }
      
      let html = '<ul class="space-y-3">';
      history.forEach(item => {
        html += `
          <li class="flex justify-between items-center border-b pb-2">
            <div>
              <span class="font-medium">${item.name}</span>
              <div class="text-sm text-gray-500">${item.date}</div>
            </div>
            <span class="font-bold text-blue-600">${item.calories} kcal</span>
          </li>
        `;
      });
      html += '</ul>';
      
      historyList.innerHTML = html;
    }
    
    // åˆå§‹åŒ–æ˜¾ç¤º
    updateHistoryDisplay();
  </script>
</body>
</html>
